# SportBuddy Backend

## Описание

Бэкенд для приложения SportBuddy с авторизацией через Telegram (deep linking + подтверждение через бота).

### Реализовано на данный момент
- Вход через Telegram с помощью уникального токена и deep link (`/auth/telegram/start`)
- Подтверждение входа через Telegram-бота (бот слушает /start и кнопку "Подтвердить вход")
- Проверка статуса входа по токену (`/auth/telegram/status/:token`)
- Тестовый маршрут для проверки подключения к базе данных (`/test-db`)

## Алгоритм входа через Telegram
1. Пользователь нажимает "Войти через Telegram" в приложении.
2. Приложение запрашивает ссылку для входа через `/auth/telegram/start`.
3. Пользователь переходит по deep link в Telegram, бот получает команду `/start token_xxx`.
4. Бот отправляет пользователю кнопку "Подтвердить вход".
5. Пользователь нажимает кнопку, бот сообщает серверу о подтверждении.
6. Приложение опрашивает `/auth/telegram/status/:token` и, получив статус `confirmed`, завершает вход.

## API

### POST `/auth/telegram/start`
- Генерирует токен и deep link для входа через Telegram.
- Ответ: `{ url, token }`

### GET `/auth/telegram/status/:token`
- Проверяет статус входа по токену.
- Ответ: `{ status: 'pending' | 'waiting_confirm' | 'confirmed' | 'not_found', telegram_id?, telegram_username? }`

### GET `/test-db`
- Проверка подключения к базе данных.

## Как протестировать
1. Запросить ссылку через `/auth/telegram/start` (POST).
2. Перейти по ссылке, нажать Start и "Подтвердить вход" в Telegram.
3. Проверять статус токена через `/auth/telegram/status/:token` (GET).
4. После подтверждения получить Telegram ID и username для дальнейшей авторизации.

---

**Внимание:**
- Для production рекомендуется хранить токены входа и их статусы в Redis или базе данных, а не в памяти.
- Для полноценной регистрации пользователя стоит добавить сохранение профиля в БД после подтверждения входа. 